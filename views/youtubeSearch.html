<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Search</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #ff0000;
        }

        form {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            margin-right: 10px;
            align-self: center;
        }

        input[type="text"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 300px;
            font-size: 16px;
        }

        button {
            padding: 10px 15px;
            background-color: #ff0000;
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 10px; /* Space between input and button */
        }

        button:hover {
            background-color: #e60000;
        }

        #sorting {
            margin: 20px auto; /* Center alignment */
            display: none; /* Initially hidden */
            width: 100%; /* Full width for proper centering */
            text-align: center; /* Center text inside */
        }

        #sorting label {
            font-weight: bold;
            margin-right: 10px;
        }

        #sorting select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        #results {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #results h2 {
            color: #444;
            margin-bottom: 15px;
        }

        #results div {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 20px;
            width: 80%;
            max-width: 600px;
        }

        #results img {
            max-width: 100%;
            border-radius: 4px;
            margin-top: 10px;
        }

        @media (max-width: 600px) {
            form {
                flex-direction: column;
                align-items: center;
            }

            input[type="text"] {
                width: 100%;
                margin-bottom: 10px;
            }

            button {
                width: 100%;
            }

            #results div {
                width: 90%;
            }
        }
    </style>
    <script>
        let currentVideos = []; // Store the fetched videos

        async function searchVideos(event) {
            event.preventDefault(); // Prevent form submission

            const query = document.getElementById('query').value; // Get the query from input
            const response = await fetch(`/internal/v1/videos/search?query=${encodeURIComponent(query)}`); // Fetch the data from the API

            if (response.ok) {
                currentVideos = await response.json(); // Store the fetched data
                renderResults(currentVideos); // Render the results
            } else {
                console.error('Failed to fetch videos', response.status);
                document.getElementById('results').innerHTML = '<p>Error fetching videos.</p>';
            }
        }

        function renderResults(videos) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = ''; // Clear previous results

            const sortingContainer = document.getElementById('sorting');
            if (videos && videos.length > 0) {
                // Show sorting options only when videos are available
                sortingContainer.style.display = 'block'; // Show sorting options
                videos.forEach(video => {
                    const videoDiv = document.createElement('div');
                    videoDiv.innerHTML = `
                        <h3>${video.title}</h3>
                        <p>${video.description}</p>
                        <p>Published at: ${new Date(video.published_at).toLocaleString()}</p>
                        <img src="${video.thumbnail_url}" alt="Thumbnail">
                    `;
                    resultsContainer.appendChild(videoDiv);
                });
            } else {
                sortingContainer.style.display = 'none'; // Hide sorting options
                resultsContainer.innerHTML = '<p>No videos found.</p>';
            }
        }

        function sortResults(order) {
            if (currentVideos.length > 0) {
                const sortedVideos = [...currentVideos];
                sortedVideos.sort((a, b) => {
                    const dateA = new Date(a.published_at);
                    const dateB = new Date(b.published_at);
                    return order === 'asc' ? dateA - dateB : dateB - dateA;
                });
                renderResults(sortedVideos); // Render sorted results
            }
        }
    </script>
</head>
<body>
<h1>YouTube Video Search</h1>

<form onsubmit="searchVideos(event)">
    <label for="query">Search Query:</label>
    <input type="text" id="query" name="query" placeholder="Enter your search query" required>
    <button type="submit">Search</button>
</form>

<div id="sorting">
    <label for="sortOrder">Sort by Published Date:</label>
    <select id="sortOrder" onchange="sortResults(this.value)">
        <option value="desc">Newest First</option>
        <option value="asc">Oldest First</option>
    </select>
</div>

<div id="results">
    <h2>Search Results:</h2>
    <!-- Search results will be rendered here -->
</div>
</body>
</html>
